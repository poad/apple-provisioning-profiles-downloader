{"version":3,"sources":["../src/client.ts"],"sourcesContent":["import {BundleIdsResponse} from './@types'\nimport {tokenSync} from 'appstore-connect-jwt-generator-core'\nimport fetch from 'cross-fetch'\n\ninterface IClient {\n  listBundleIds: (query?: {[key: string]: string}) => Promise<BundleIdsResponse>\n  token: () => string\n}\n\nexport class Client implements IClient {\n  jwt: string\n\n  constructor(param: {\n    privateKey: string | Buffer\n    issuerId: string\n    apiKeyId: string\n    duration?: number\n  }) {\n    const {privateKey, issuerId, apiKeyId, duration} = param\n    this.jwt = tokenSync(privateKey, issuerId, apiKeyId, duration)\n  }\n  listBundleIds = async (query?: {\n    [key: string]: string\n  }): Promise<BundleIdsResponse> => {\n    const queryString = query\n      ? Object.entries(query)\n          .map(entry => `${entry[0]}=${encodeURIComponent(entry[1])}`)\n          .reduce((acc: string, cur: string) => `${acc}&${cur}`)\n      : ''\n\n    const headers = {\n      Authorization: `Bearer ${this.jwt}`\n    }\n\n    const uri = `https://api.appstoreconnect.apple.com/v1/bundleIds${\n      queryString.length > 0 ? '?' : ''\n    }${queryString}`\n\n    const response = await fetch(uri, {\n      headers\n    })\n\n    if (response.status !== 200) {\n      const text = await response.text()\n      console.error(text)\n      throw new Error(text)\n    }\n    return response.json() as Promise<BundleIdsResponse>\n  }\n  token = (): string => this.jwt\n}\n\nexport default Client\n"],"names":["tokenSync","fetch","Client","param","listBundleIds","query","queryString","Object","entries","map","entry","encodeURIComponent","reduce","acc","cur","headers","Authorization","jwt","uri","length","response","status","text","console","error","Error","json","token","privateKey","issuerId","apiKeyId","duration"],"mappings":"AACA,MAAM,GAAEA,SAAS,QAAO,CAAqC;AAC7D,MAAM,CAACC,KAAK,MAAM,CAAa;AAO/B,MAAM,OAAOC,MAAM;gBAGLC,KAKX,CAAE,CAAC;QARC,IAyCN,CA7BCC,aAAa,UAAUC,KAEtB,GAAiC,CAAC;YACjC,KAAK,CAACC,WAAW,GAAGD,KAAK,GACrBE,MAAM,CAACC,OAAO,CAACH,KAAK,EACjBI,GAAG,EAACC,KAAK,MAAOA,KAAK,CAAC,CAAC,EAAE,CAAC,EAAEC,kBAAkB,CAACD,KAAK,CAAC,CAAC;cACtDE,MAAM,EAAEC,GAAW,EAAEC,GAAW,MAAQD,GAAG,CAAC,CAAC,EAAEC,GAAG;gBACrD,CAAE;YAEN,KAAK,CAACC,OAAO,GAAG,CAAC;gBACfC,aAAa,GAAG,OAAO,EAAE,IAAI,CAACC,GAAG;YACnC,CAAC;YAED,KAAK,CAACC,GAAG,IAAI,kDAAkD,EAC7DZ,WAAW,CAACa,MAAM,GAAG,CAAC,GAAG,CAAG,KAAG,CAAE,IAChCb,WAAW;YAEd,KAAK,CAACc,QAAQ,GAAG,KAAK,CAACnB,KAAK,CAACiB,GAAG,EAAE,CAAC;gBACjCH,OAAO;YACT,CAAC;YAED,EAAE,EAAEK,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE,CAAC;gBAC5B,KAAK,CAACC,IAAI,GAAG,KAAK,CAACF,QAAQ,CAACE,IAAI;gBAChCC,OAAO,CAACC,KAAK,CAACF,IAAI;gBAClB,KAAK,CAAC,GAAG,CAACG,KAAK,CAACH,IAAI;YACtB,CAAC;YACD,MAAM,CAACF,QAAQ,CAACM,IAAI;QACtB,CAAC;QAvCI,IAyCN,CADCC,KAAK,OAAiB,IAAI,CAACV,GAAG;;QA/B5B,KAAK,CAAC,CAACW,CAAAA,UAAU,GAAEC,QAAQ,GAAEC,QAAQ,GAAEC,QAAQ,EAAA,CAAC,GAAG5B,KAAK;QACxD,IAAI,CAACc,GAAG,GAAGjB,SAAS,CAAC4B,UAAU,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,QAAQ;IAC/D,CAAC;;AAgCH,MAAM,SAAS7B,MAAM"}