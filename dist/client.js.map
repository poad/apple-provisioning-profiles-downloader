{"version":3,"sources":["../src/client.ts"],"sourcesContent":["import {BundleIdsResponse} from './@types'\nimport { tokenSync } from 'appstore-connect-jwt-generator-core'\nimport fetch from 'cross-fetch'\n\nmodule appStoreConnect {\n  let jwt: string\n  const listBundleIds = async (query?: {\n    [key: string]: string\n  }): Promise<BundleIdsResponse> => {\n    const queryString = query\n      ? Object.entries(query)\n          .map(entry => `${entry[0]}=${encodeURIComponent(entry[1])}`)\n          .reduce((acc: string, cur: string) => `${acc}&${cur}`)\n      : ''\n\n    const headers = {\n      Authorization: `Bearer ${jwt}`\n    }\n\n    const uri = `https://api.appstoreconnect.apple.com/v1/bundleIds${\n      queryString.length > 0 ? '?' : ''\n    }${queryString}`\n\n    const response = await fetch(uri, {\n      headers\n    })\n\n    if (response.status !== 200) {\n      const text = await response.text()\n      console.error(text)\n      throw new Error(text)\n    }\n    return response.json() as Promise<BundleIdsResponse>\n  }\n\n  export const Client = (param: {\n    privateKey: string | Buffer\n    issuerId: string\n    apiKeyId: string\n    duration?: number\n  }): {\n    listBundleIds: (query?: {\n      [key: string]: string\n    }) => Promise<BundleIdsResponse>\n    token: () => string\n  } => {\n    const {privateKey, issuerId, apiKeyId, duration} = param\n    jwt = tokenSync(privateKey, issuerId, apiKeyId, duration)\n    return {\n      listBundleIds,\n      token: () => jwt\n    }\n  }\n}\n\nexport default appStoreConnect\n"],"names":["tokenSync","fetch"],"mappings":"AACA,MAAM,GAAGA,SAAS,QAAQ,CAAqC;AAC/D,MAAM,CAACC,KAAK,MAAM,CAAa;AAE/B,GAAM;;IACJ,GAAG,CAAC,GAAG;IACP,KAAK,CAAC,aAAa,UAAU,KAE5B,GAAiC,CAAC;QACjC,KAAK,CAAC,WAAW,GAAG,KAAK,GACrB,MAAM,CAAC,OAAO,CAAC,KAAK,EACjB,GAAG,EAAC,KAAK,MAAO,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,kBAAkB,CAAC,KAAK,CAAC,CAAC;UACtD,MAAM,EAAE,GAAW,EAAE,GAAW,MAAQ,GAAG,CAAC,CAAC,EAAE,GAAG;YACrD,CAAE;QAEN,KAAK,CAAC,OAAO,GAAG,CAAC;YACf,aAAa,GAAG,OAAO,EAAE,GAAG;QAC9B,CAAC;QAED,KAAK,CAAC,GAAG,IAAI,kDAAkD,EAC7D,WAAW,CAAC,MAAM,GAAG,CAAC,GAAG,CAAG,KAAG,CAAE,IAChC,WAAW;QAEd,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;YACjC,OAAO;QACT,CAAC;QAED,EAAE,EAAE,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE,CAAC;YAC5B,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI;YAChC,OAAO,CAAC,KAAK,CAAC,IAAI;YAClB,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI;QACtB,CAAC;QACD,MAAM,CAAC,QAAQ,CAAC,IAAI;IACtB,CAAC;qBAEY,MAAM,IAAI,KAKtB,GAKI,CAAC;QACJ,KAAK,CAAC,CAAC,CAAA,UAAU,GAAE,QAAQ,GAAE,QAAQ,GAAE,QAAQ,EAAA,CAAC,GAAG,KAAK;QACxD,GAAG,GAAG,SAAS,CAAC,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ;QACxD,MAAM,CAAC,CAAC;YACN,aAAa;YACb,KAAK,MAAQ,GAAG;QAClB,CAAC;IACH,CAAC;GAhDI,eAAe,KAAf,eAAe"}